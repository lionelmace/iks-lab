
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Provisioning with Terraform Â· IBM Cloud Kubernetes Service Lab</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="calico.html" />
    
    
    <link rel="prev" href="weavescope.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Lab Overview
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Preparation</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="prepare-prereq.html">
            
                <a href="prepare-prereq.html">
            
                    
                        <b>2.1.</b>
                    
                    Pre-Requisites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="prepare-plugins.html">
            
                <a href="prepare-plugins.html">
            
                    
                        <b>2.2.</b>
                    
                    Install Container Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="login.html">
            
                <a href="login.html">
            
                    
                        <b>2.3.</b>
                    
                    Connect IBM Cloud Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="prepare-get-cluster.html">
            
                <a href="prepare-get-cluster.html">
            
                    
                        <b>2.4.</b>
                    
                    Get a cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="connect-via-cli.html">
            
                <a href="connect-via-cli.html">
            
                    
                        <b>2.5.</b>
                    
                    Connect via CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="prepare-target.html">
            
                <a href="prepare-target.html">
            
                    
                        <b>2.6.</b>
                    
                    Target your environement
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 1 - Deploy an app in a Kubernetes cluster</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="view-cluster.html">
            
                <a href="view-cluster.html">
            
                    
                        <b>3.1.</b>
                    
                    View your cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="kube-dashboard.html">
            
                <a href="kube-dashboard.html">
            
                    
                        <b>3.2.</b>
                    
                    Kubernetes Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="get-app.html">
            
                <a href="get-app.html">
            
                    
                        <b>3.3.</b>
                    
                    Get and run the app locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="docker-build.html">
            
                <a href="docker-build.html">
            
                    
                        <b>3.4.</b>
                    
                    Build docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="docker-push.html">
            
                <a href="docker-push.html">
            
                    
                        <b>3.5.</b>
                    
                    Push docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="deploy-app.html">
            
                <a href="deploy-app.html">
            
                    
                        <b>3.6.</b>
                    
                    Deploy app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="scale-app.html">
            
                <a href="scale-app.html">
            
                    
                        <b>3.7.</b>
                    
                    Scale app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="connect-database.html">
            
                <a href="connect-database.html">
            
                    
                        <b>3.8.</b>
                    
                    Optional: Connect to a database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="test-resiliency.html">
            
                <a href="test-resiliency.html">
            
                    
                        <b>3.9.</b>
                    
                    Optional: Test the resiliency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="clean-up.html">
            
                <a href="clean-up.html">
            
                    
                        <b>3.10.</b>
                    
                    Clean up
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 2 - DevOps and Helm charts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="devops-helm.html">
            
                <a href="devops-helm.html">
            
                    
                        <b>4.1.</b>
                    
                    Deploy with Helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="devops-continuous-delivery.html">
            
                <a href="devops-continuous-delivery.html">
            
                    
                        <b>4.2.</b>
                    
                    Deploy with Continuous Delivery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="monitor-debug.html">
            
                <a href="monitor-debug.html">
            
                    
                        <b>4.3.</b>
                    
                    Optional: Troubleshoot and Debug
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 3 - Monitor your cluster</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="monitor-cluster-logs.html">
            
                <a href="monitor-cluster-logs.html">
            
                    
                        <b>5.1.</b>
                    
                    Cluster Logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="monitor-cluster-metrics.html">
            
                <a href="monitor-cluster-metrics.html">
            
                    
                        <b>5.2.</b>
                    
                    Monitoring your cluster
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="appendix-create-cluster-cli.html">
            
                <a href="appendix-create-cluster-cli.html">
            
                    
                        <b>6.1.</b>
                    
                    Create a cluster with CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="appendix-create-cluster-ui.html">
            
                <a href="appendix-create-cluster-ui.html">
            
                    
                        <b>6.2.</b>
                    
                    Create a cluster in the Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="weavescope.html">
            
                <a href="weavescope.html">
            
                    
                        <b>6.3.</b>
                    
                    Weavescope
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="6.4" data-path="appendix-terraform.html">
            
                <a href="appendix-terraform.html">
            
                    
                        <b>6.4.</b>
                    
                    Provisioning with Terraform
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="calico.html">
            
                <a href="calico.html">
            
                    
                        <b>6.5.</b>
                    
                    Control traffic with Calico
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="appendix.html">
            
                <a href="appendix.html">
            
                    
                        <b>6.6.</b>
                    
                    Appendix
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="resources.html">
            
                <a href="resources.html">
            
                    
                        <b>7.1.</b>
                    
                    Resources
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Provisioning with Terraform</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="deploy-the-solution-using-terraform">Deploy the solution using Terraform</h1>
<p><a href="https://www.terraform.io/" target="_blank">Terraform</a> enables you to safely and predictably create, change, and improve infrastructure. It is an open source tool that codifies APIs into declarative configuration files that can be shared amongst team members, treated as code, edited, reviewed, and versioned.</p>
<p>In this tutorial, you will use a sample configuration to provision a <strong>Kubernetes cluster</strong>, and, a <strong>Postgres</strong> database. Finish by deleting all of the resources created by the configuration.</p>
<h2 id="install-terraform">Install Terraform</h2>
<ol>
<li><p>Download and install Terraform for your system. <a href="https://learn.hashicorp.com/terraform/getting-started/install.html" target="_blank">https://learn.hashicorp.com/terraform/getting-started/install.html</a></p>
</li>
<li><p>On MacOS, Terraform can also be installed using Terraform version manager <code>tfenv</code></p>
<pre class="language-"><code> brew install tfenv
</code></pre><pre class="language-"><code> tfenv install <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>
</code></pre><p> For example:</p>
<pre class="language-"><code> tfenv install 0.12.24
</code></pre></li>
<li><p>Check Terraform installation by running <strong>terraform</strong> in your terminal or command prompt window. You should see a list of <strong>Common commands</strong>.</p>
</li>
</ol>
<h2 id="install-ibm-cloud-provider">Install IBM Cloud Provider</h2>
<ol>
<li><p>Download the IBM Cloud Provider plugin. <a href="https://github.com/IBM-Cloud/terraform-provider-ibm/releases" target="_blank">https://github.com/IBM-Cloud/terraform-provider-ibm/releases</a></p>
</li>
<li><p>Extract the archive</p>
</li>
<li><p>Create a hidden folder for your plug-in.</p>
<pre class="language-"><code> mkdir $HOME/.terraform.d/plugins
</code></pre></li>
<li><p>Move the IBM Cloud Provider plug-in you extracted into your hidden folder.</p>
<pre class="language-"><code> mv $HOME/Downloads/terraform-provider-ibm* $HOME/.terraform.d/plugins/
</code></pre></li>
<li><p>Create a .terraformrc file in your home directory that points to the Terraform binary.</p>
<pre class="language-"><code> vi ~/.terraformrc
</code></pre><p> with the following content:</p>
<pre class="language-"><code> providers {
   ibm = &quot;$HOME/.terraform.d/plugins/terraform-provider-ibm_v1.9.0&quot;
 }
</code></pre><blockquote>
<p>Note: Update the provider version accordingly.</p>
</blockquote>
</li>
<li><p>Export API credential tokens as environment variables</p>
<pre class="language-"><code> export IC_API_KEY=&quot;Your IBM Cloud API Key&quot;
</code></pre></li>
</ol>
<h2 id="initialize-terraform">Initialize Terraform</h2>
<ol>
<li><p>Go to the terraform folder</p>
<pre class="language-"><code> cd .cloud/terraform
</code></pre></li>
<li><p>Terraform must initialize the provider before it can be used.</p>
<pre class="language-"><code> terraform init
</code></pre></li>
<li><p>Verify the terraform provider is installed</p>
<pre class="language-"><code> terraform providers
</code></pre><p> Output:</p>
<pre class="language-"><code> .
 &#x2514;&#x2500;&#x2500; provider.ibm
</code></pre></li>
<li><p>Copy terraform/credentials.tfvars.tmpl to terraform/credentials.tfvars by running the below command</p>
<pre class="language-"><code> cp terraform/credentials.tfvars.tmpl terraform/credentials.tfvars
</code></pre></li>
<li><p>Edit terraform/credentials.tfvars and set the value for ibmcloud_api_key to the Platform API key you obtained.</p>
</li>
<li><p>To provision the cluster, the terraform needs your Infrastructure API. To do so, go to <a href="https://cloud.ibm.com/iam#/users" target="_blank">https://cloud.ibm.com/iam#/users</a></p>
</li>
<li><p>Select the User</p>
</li>
<li><p>Scroll down to API Keys</p>
</li>
<li><p>Select the <strong>Classic infrastructure API key</strong> - To see your classic infrastructure API key details, select Details in the Options menu.</p>
</li>
</ol>
<h2 id="provision-a-kubernetes-cluster">Provision a Kubernetes cluster</h2>
<ol>
<li><p>Perform a dry run to show what infrastructure terraform intends to create</p>
<pre class="language-"><code> terraform plan
</code></pre><blockquote>
<p>You can activate debug log by running: <em>export TF_LOG=TRACE</em></p>
</blockquote>
</li>
<li><p>Start provisioning</p>
<pre class="language-"><code> terraform apply
 terraform apply -target=ibm_container_cluster.cluster
</code></pre></li>
<li><p>Once provisioned, reads and outputs a Terraform state or plan file in a human-readable form.</p>
<pre class="language-"><code> terraform show
</code></pre></li>
<li><p>Clean up</p>
<pre class="language-"><code> terraform destroy
</code></pre></li>
</ol>
<h2 id="resources">Resources</h2>
<p>For additional resources pay close attention to the following:</p>
<ul>
<li><a href="https://cloud.ibm.com/docs/tutorials?topic=solution-tutorials-infrastructure-as-code-terraform#setup" target="_blank">Tutorial: Deploy a LAMP stack using Terraform</a></li>
<li><a href="https://cloud.ibm.com/docs/tutorials/plan-create-update-deployments.html#plan-create-and-update-deployment-environments" target="_blank">Tutorial: Plan, create and update deployment environments</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="weavescope.html" class="navigation navigation-prev " aria-label="Previous page: Weavescope">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="calico.html" class="navigation navigation-next " aria-label="Next page: Control traffic with Calico">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Provisioning with Terraform","level":"6.4","depth":1,"next":{"title":"Control traffic with Calico","level":"6.5","depth":1,"path":"calico.md","ref":"calico.md","articles":[]},"previous":{"title":"Weavescope","level":"6.3","depth":1,"path":"weavescope.md","ref":"weavescope.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header"],"root":"book","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"IBM Cloud Kubernetes Service (IKS) Lab"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"IBM Cloud Kubernetes Service Lab","gitbook":"3.2.3"},"file":{"path":"appendix-terraform.md","mtime":"2018-11-11T11:11:11.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-11T11:11:11.000Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

