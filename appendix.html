
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Appendix Â· IBM Cloud Kubernetes Service Lab</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="prepare-prereq.html" />
    
    
    <link rel="prev" href="calico.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Lab Overview
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 2 - Access the cluster</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="01-get-cluster.html">
            
                <a href="01-get-cluster.html">
            
                    
                        <b>2.1.</b>
                    
                    Get a cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="01-view-cluster.html">
            
                <a href="01-view-cluster.html">
            
                    
                        <b>2.2.</b>
                    
                    View your cluster in the Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="01-kube-dashboard.html">
            
                <a href="01-kube-dashboard.html">
            
                    
                        <b>2.3.</b>
                    
                    Kubernetes Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="01-connect-to-ibm-cloud.html">
            
                <a href="01-connect-to-ibm-cloud.html">
            
                    
                        <b>2.4.</b>
                    
                    Connect to IBM Cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="01-connect-cli.html">
            
                <a href="01-connect-cli.html">
            
                    
                        <b>2.5.</b>
                    
                    Access your cluster
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 3 - Deploy an app</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="02-run-app.html">
            
                <a href="02-run-app.html">
            
                    
                        <b>3.1.</b>
                    
                    Get and run the app locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="02-docker-build.html">
            
                <a href="02-docker-build.html">
            
                    
                        <b>3.2.</b>
                    
                    Build docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="02-docker-push.html">
            
                <a href="02-docker-push.html">
            
                    
                        <b>3.3.</b>
                    
                    Push docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="02-deploy-app.html">
            
                <a href="02-deploy-app.html">
            
                    
                        <b>3.4.</b>
                    
                    Deploy app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="02-scale-app.html">
            
                <a href="02-scale-app.html">
            
                    
                        <b>3.5.</b>
                    
                    Scale app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="02-connect-db.html">
            
                <a href="02-connect-db.html">
            
                    
                        <b>3.6.</b>
                    
                    Optional: Connect to a database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="02-test-resiliency.html">
            
                <a href="02-test-resiliency.html">
            
                    
                        <b>3.7.</b>
                    
                    Optional: Test the resiliency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="02-deploy-custom-domain.html">
            
                <a href="02-deploy-custom-domain.html">
            
                    
                        <b>3.8.</b>
                    
                    Optional: Use a custom domain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="02-clean-up.html">
            
                <a href="02-clean-up.html">
            
                    
                        <b>3.9.</b>
                    
                    Clean up
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 4 - DevOps and Helm charts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="03-devops-helm.html">
            
                <a href="03-devops-helm.html">
            
                    
                        <b>4.1.</b>
                    
                    Deploy with Helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="03-devops-continuous-delivery.html">
            
                <a href="03-devops-continuous-delivery.html">
            
                    
                        <b>4.2.</b>
                    
                    Deploy with Continuous Delivery
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 5 - Monitor your cluster</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="monitor-cluster-logs.html">
            
                <a href="monitor-cluster-logs.html">
            
                    
                        <b>5.1.</b>
                    
                    Cluster Logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="monitor-cluster-metrics.html">
            
                <a href="monitor-cluster-metrics.html">
            
                    
                        <b>5.2.</b>
                    
                    Monitoring your cluster
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="deploy-app-custom-ns.html">
            
                <a href="deploy-app-custom-ns.html">
            
                    
                        <b>6.1.</b>
                    
                    Deploy app in custom namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="gitlab-registry.html">
            
                <a href="gitlab-registry.html">
            
                    
                        <b>6.2.</b>
                    
                    Using Gitlab Registry with Kubernetes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="appendix-create-cluster-cli.html">
            
                <a href="appendix-create-cluster-cli.html">
            
                    
                        <b>6.3.</b>
                    
                    Create a cluster with CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="weavescope.html">
            
                <a href="weavescope.html">
            
                    
                        <b>6.4.</b>
                    
                    Weavescope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="appendix-terraform.html">
            
                <a href="appendix-terraform.html">
            
                    
                        <b>6.5.</b>
                    
                    Provisioning with Terraform
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="calico.html">
            
                <a href="calico.html">
            
                    
                        <b>6.6.</b>
                    
                    Control traffic with Calico
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="6.7" data-path="appendix.html">
            
                <a href="appendix.html">
            
                    
                        <b>6.7.</b>
                    
                    Appendix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="prepare-prereq.html">
            
                <a href="prepare-prereq.html">
            
                    
                        <b>6.8.</b>
                    
                    Pre-Requisites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.9" data-path="prepare-plugins.html">
            
                <a href="prepare-plugins.html">
            
                    
                        <b>6.9.</b>
                    
                    Install Container Plugins
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="resources.html">
            
                <a href="resources.html">
            
                    
                        <b>7.1.</b>
                    
                    Resources
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Appendix</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="appendixes">Appendixes</h1>
<h2 id="appendix---assigning-access-to-namespaces">Appendix - Assigning Access to Namespaces</h2>
<pre class="language-"><code>```
ibmcloud iam user-policy-create xxx.xxx@fr.ibm.com \
--service-name containers-kubernetes \
--service-instance 03cf54bd4548416581e63783dbe645c2 \
--region us-south \
--resource-type namespace \
--resource kube-system \
--roles Viewer
```
</code></pre><h2 id="appendix---issues-when-pushing-to-the-container-registry">Appendix - Issues when pushing to the container registry</h2>
<p>Below is a list of solutions to resolve issues you may face when pushing your images into the Container Registry.</p>
<ol>
<li><p>Error: Request access to the resource is denied</p>
<pre class="language-"><code> denied: requested access to the resource is denied
</code></pre><p> Note that adding a namespace only affects one region - if you want the same namespace in multiple regions you need to target each region and add it in each one. Make sure the namespace you are trying to push the image to exists.</p>
</li>
<li><p>Error: You have exceeded your storage quota</p>
<p> In this tutorial, the image is less than 100MB. Once you start pushing images you will rapidly reach the default limit of 500MB and get the following error:</p>
<pre class="language-"><code> unauthorized: You have exceeded your storage quota. Delete one or more images, or review your storage quota and pricing plan
</code></pre><p> Check the current quota:</p>
<pre class="language-"><code> ibmcloud cr quota
 Getting quotas and usage for the current month, for account &apos;IBM&apos;...

 QUOTA          LIMIT    USED     ADDITIONAL INFORMATION
 Pull traffic   5.0 GB   0 B
 Storage        512 MB   546 MB   Your account has exceeded its storage quota. Delete one or more images, or review your storage quota and pricing plan.
</code></pre><p> Check the current plan:</p>
<pre class="language-"><code> ibmcloud cr plan
 Getting pricing plan for account &apos;Lionel Mace&apos;s Account&apos;...

 You are on the &apos;Free&apos; pricing plan.
</code></pre><p> You increase your quota you will need to upgrade plan:</p>
<pre class="language-"><code> ibmcloud cr plan-upgrade standard
</code></pre><p> Finally, you will increase the quota or just set to Unlimited</p>
<pre class="language-"><code> ibmcloud cr quota-set --storage unlimited
</code></pre></li>
</ol>
<h2 id="appendix---using-kubernetes-namespaces">Appendix - Using Kubernetes namespaces</h2>
<p>In order to isolate the applications you deploy in the cluster, you may want to leverage Kubernetes namespace. Using namespace has an impact on the following commands:</p>
<ol>
<li><p>Create a new namespace in your cluster. Let&apos;s call it <em>mytodo</em></p>
<pre class="language-"><code> kubectl create namespace mytodo
</code></pre></li>
<li><p>Verify your new namespace was created</p>
<pre class="language-"><code> kubectl get namespaces
</code></pre></li>
<li><p>The service cloudant should be bound in this namespace</p>
<pre class="language-"><code> ibmcloud ks cluster-service-bind <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cluster_id</span><span class="token punctuation">&gt;</span></span> mytodo <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service_instance_name</span><span class="token punctuation">&gt;</span></span>
</code></pre><p> Example:</p>
<pre class="language-"><code> ibmcloud ks cluster-service-bind ad35aacc139b4e11a6f3182fb13d24af mytodo todo-cloudant
</code></pre></li>
<li><p>The new namespace does not contain the secret to access the private container registry. The default namespace has by default this secret to access the registry. If you try to deploy without this step, you will get this error:</p>
<blockquote>
<p>Failed to pull image &quot;de.icr.io/mace/mytodo:1&quot;: rpc error: code = Unknown desc = Error response from daemon: Get <a href="https://de.icr.io/v2/mace/mytodo/manifests/v1" target="_blank">https://de.icr.io/v2/mace/mytodo/manifests/v1</a>: unauthorized: authentication required</p>
</blockquote>
<p> In order to add this registry secret, run the following command:</p>
<pre class="language-"><code> kubectl --namespace <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CLUSTER_NAMESPACE</span><span class="token punctuation">&gt;</span></span> create secret docker-registry <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IMAGE_REGISTRY_SECRET_NAME</span><span class="token punctuation">&gt;</span></span> --docker-server=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>REGISTRY_URL</span><span class="token punctuation">&gt;</span></span> --docker-password=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IBMCLOUD_API_KEY</span><span class="token punctuation">&gt;</span></span> --docker-username=iamapikey --docker-email=a@b.com
</code></pre><p> For example:</p>
<pre class="language-"><code> kubectl --namespace mytodo create secret docker-registry private-registry-secret --docker-server=de.icr.io --docker-password=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>IBMCLOUD_API_KEY</span><span class="token punctuation">&gt;</span></span> --docker-username=iamapikey --docker-email=a@b.com
</code></pre><blockquote>
<p>You can generate the api key using the following command:
 <code>ibmcloud iam api-key-create IBMCLOUD_API_KEY</code></p>
</blockquote>
</li>
<li><p>Modify the yml file to set the image registry secret.</p>
<pre class="language-"><code class="lang-yaml"> <span class="token punctuation">---</span>
 <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
 <span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
 <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> mytodo
 <span class="token key atrule">spec</span><span class="token punctuation">:</span>
 <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment"># tells deployment to run 2 pods matching the template</span>
 <span class="token key atrule">template</span><span class="token punctuation">:</span> <span class="token comment"># create pods using pod definition in this template</span>
     <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
     <span class="token key atrule">labels</span><span class="token punctuation">:</span>
         <span class="token key atrule">app</span><span class="token punctuation">:</span> mytodo
         <span class="token key atrule">tier</span><span class="token punctuation">:</span> frontend
     <span class="token key atrule">spec</span><span class="token punctuation">:</span>
     <span class="token key atrule">imagePullSecrets</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> private<span class="token punctuation">-</span>registry<span class="token punctuation">-</span>secret
     <span class="token key atrule">containers</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mytodo
         <span class="token key atrule">image</span><span class="token punctuation">:</span> &lt;registry<span class="token punctuation">-</span>region<span class="token punctuation">&gt;</span>.icr.io/&lt;namespace<span class="token punctuation">&gt;</span>/mytodo<span class="token punctuation">:</span><span class="token number">1</span>
         <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
     <span class="token punctuation">...</span>
</code></pre>
</li>
<li><p>Deploy the container in the new namespace</p>
<pre class="language-"><code> kubectl create -f deploy2kubernetes.yml --namespace mytodo
</code></pre></li>
</ol>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="calico.html" class="navigation navigation-prev " aria-label="Previous page: Control traffic with Calico">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="prepare-prereq.html" class="navigation navigation-next " aria-label="Next page: Pre-Requisites">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Appendix","level":"6.7","depth":1,"next":{"title":"Pre-Requisites","level":"6.8","depth":1,"path":"prepare-prereq.md","ref":"prepare-prereq.md","articles":[]},"previous":{"title":"Control traffic with Calico","level":"6.6","depth":1,"path":"calico.md","ref":"calico.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header"],"root":"book","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"IBM Cloud Kubernetes Service (IKS) Lab"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"IBM Cloud Kubernetes Service Lab","gitbook":"3.2.3"},"file":{"path":"appendix.md","mtime":"2018-11-11T11:11:11.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-11T11:11:11.000Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

