
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Cluster Logs Â· IBM Cloud Kubernetes Service Lab</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-tomorrow.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-hints/plugin-hints.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-web-header/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="monitor-cluster-metrics.html" />
    
    
    <link rel="prev" href="devops-continuous-delivery.md" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Introduction</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Lab Overview
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 2 - Access the cluster</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="01-get-cluster.html">
            
                <a href="01-get-cluster.html">
            
                    
                        <b>2.1.</b>
                    
                    Get a cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="01-view-cluster.html">
            
                <a href="01-view-cluster.html">
            
                    
                        <b>2.2.</b>
                    
                    View your cluster in the Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="01-kube-dashboard.html">
            
                <a href="01-kube-dashboard.html">
            
                    
                        <b>2.3.</b>
                    
                    Kubernetes Dashboard
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="01-connect-to-ibm-cloud.html">
            
                <a href="01-connect-to-ibm-cloud.html">
            
                    
                        <b>2.4.</b>
                    
                    Connect to IBM Cloud
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="01-connect-cli.html">
            
                <a href="01-connect-cli.html">
            
                    
                        <b>2.5.</b>
                    
                    Access your cluster
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 3 - Deploy an app</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="02-run-app.html">
            
                <a href="02-run-app.html">
            
                    
                        <b>3.1.</b>
                    
                    Get and run the app locally
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="02-docker-build.html">
            
                <a href="02-docker-build.html">
            
                    
                        <b>3.2.</b>
                    
                    Build docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="02-docker-push.html">
            
                <a href="02-docker-push.html">
            
                    
                        <b>3.3.</b>
                    
                    Push docker image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="02-deploy-app.html">
            
                <a href="02-deploy-app.html">
            
                    
                        <b>3.4.</b>
                    
                    Deploy app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="02-scale-app.html">
            
                <a href="02-scale-app.html">
            
                    
                        <b>3.5.</b>
                    
                    Scale app
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="02-connect-db.html">
            
                <a href="02-connect-db.html">
            
                    
                        <b>3.6.</b>
                    
                    Optional: Connect to a database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="02-test-resiliency.html">
            
                <a href="02-test-resiliency.html">
            
                    
                        <b>3.7.</b>
                    
                    Optional: Test the resiliency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="02-deploy-custom-domain.html">
            
                <a href="02-deploy-custom-domain.html">
            
                    
                        <b>3.8.</b>
                    
                    Optional: Use a custom domain
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="02-clean-up.html">
            
                <a href="02-clean-up.html">
            
                    
                        <b>3.9.</b>
                    
                    Clean up
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 4 - DevOps and Helm charts</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="devops-helm.md">
            
                <span>
            
                    
                        <b>4.1.</b>
                    
                    Deploy with Helm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="devops-continuous-delivery.md">
            
                <span>
            
                    
                        <b>4.2.</b>
                    
                    Deploy with Continuous Delivery
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Lab 5 - Monitor your cluster</li>
        
        
    
        <li class="chapter active" data-level="5.1" data-path="monitor-cluster-logs.html">
            
                <a href="monitor-cluster-logs.html">
            
                    
                        <b>5.1.</b>
                    
                    Cluster Logs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="monitor-cluster-metrics.html">
            
                <a href="monitor-cluster-metrics.html">
            
                    
                        <b>5.2.</b>
                    
                    Monitoring your cluster
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Advanced</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="deploy-app-custom-ns.html">
            
                <a href="deploy-app-custom-ns.html">
            
                    
                        <b>6.1.</b>
                    
                    Deploy app in custom namespace
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="appendix-create-cluster-cli.html">
            
                <a href="appendix-create-cluster-cli.html">
            
                    
                        <b>6.2.</b>
                    
                    Create a cluster with CLI
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="weavescope.html">
            
                <a href="weavescope.html">
            
                    
                        <b>6.3.</b>
                    
                    Weavescope
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.4" data-path="appendix-terraform.html">
            
                <a href="appendix-terraform.html">
            
                    
                        <b>6.4.</b>
                    
                    Provisioning with Terraform
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.5" data-path="calico.html">
            
                <a href="calico.html">
            
                    
                        <b>6.5.</b>
                    
                    Control traffic with Calico
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.6" data-path="appendix.html">
            
                <a href="appendix.html">
            
                    
                        <b>6.6.</b>
                    
                    Appendix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.7" data-path="prepare-prereq.html">
            
                <a href="prepare-prereq.html">
            
                    
                        <b>6.7.</b>
                    
                    Pre-Requisites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.8" data-path="prepare-plugins.html">
            
                <a href="prepare-plugins.html">
            
                    
                        <b>6.8.</b>
                    
                    Install Container Plugins
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Resources</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="resources.html">
            
                <a href="resources.html">
            
                    
                        <b>7.1.</b>
                    
                    Resources
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Cluster Logs</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="logging-with-logdna">Logging with LogDNA</h1>
<p>Log Analysis with LogDNA is a third-party service that you can include as part of your IBM Cloud architecture to add log management capabilities. <strong>Log Analysis with LogDNA</strong> is operated by LogDNA in partnership with IBM.</p>
<p>In order to configure cluster-level logging for a Kubernetes cluster, you must provision an instance of Log Analysis with LogDNA service.</p>
<p>     <a href="images/logdna-architecture.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logdna-architecture.png" alt="">
     </a></p>
<h2 id="provision-an-instance-of-log-analysis-with-logdna-service">Provision an instance of Log Analysis with LogDNA service</h2>
<ol>
<li><p>Navigate to the <a href="https://cloud.ibm.com/observe" target="_blank"><strong>Observability</strong></a> page</p>
<p>      <a href="images/observe-landing.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/observe-landing.png" alt="">
     </a></p>
</li>
<li><p>Under <strong>Logging</strong>, click <strong>Create instance</strong>.</p>
</li>
<li><p>Provide a unique <strong>Service name</strong> such as <code>logdna-<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lastname</span><span class="token punctuation">&gt;</span></span></code>.</p>
</li>
<li><p>Choose a <strong>region/location</strong> and select a <strong>resource group</strong>.</p>
<p>      <a href="images/logging-creation.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logging-creation.png" alt="">
     </a></p>
<blockquote>
<p>To better govern your services, it is recommended to use the same Resource Group than the one your cluster is in.</p>
</blockquote>
</li>
<li><p>Select <strong>Lite</strong> as your plan and click <strong>Create</strong>.</p>
<p>      <a href="images/logging-plan.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logging-plan.png" alt="">
     </a></p>
</li>
<li><p>The Observability dashboard opens and shows the details for your service.</p>
</li>
</ol>
<h2 id="configure-the-cluster-to-send-logs-to-your-logdna-instance">Configure the cluster to send logs to your LogDNA instance.</h2>
<p>To configure your Kubernetes cluster to send logs to your IBM Log Analysis with LogDNA instance, you must install a <code>logdna-agent</code> pod on each node of your cluster. The LogDNA agent reads log files from the pod where it is installed, and forwards the log data to your LogDNA instance.</p>
<ol>
<li><p>Click on <strong>Edit log sources</strong> next to the service which you created earlier.</p>
<p>      <a href="images/logging-configure.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logging-configure.png" alt="">
     </a></p>
</li>
<li><p>Select <strong>Kubernetes</strong>.</p>
<p>      <a href="images/logdna-agents.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logdna-agents.png" alt="">
     </a></p>
</li>
<li><p>Copy and run the first command on a terminal where you have set the KUBECONFIG environment variable to create a kubernetes secret with the LogDNA ingestion key for your service instance.</p>
<p> In this step, you create a Kubernetes secret to store your logDNA ingestion key for your service instance. The LogDNA ingestion key is used to open a secure web socket to the logDNA ingestion server and to authenticate the logging agent with the logging service.</p>
</li>
<li><p>Copy and run the second command to create a Kubernetes daemon set to deploy the LogDNA agent on every worker node of your Kubernetes cluster.</p>
<p> The LogDNA agent collects logs with the extension *.log and extensionless files that are stored in the /var/log directory of your pod. By default, logs are collected from all namespaces, including kube-system, and automatically forwarded to the IBM Log Analysis with LogDNA service.</p>
</li>
<li><p>Verify that the LogDNA agent is deployed successfully.</p>
<pre class="language-"><code class="lang-sh"> kubectl get pods
</code></pre>
<p> Output:</p>
<p>      <a href="images/logdna-agent-pods.png" rel="grouped" title="" target="_self" class="fancybox">
       <img src="images/logdna-agent-pods.png" alt="">
     </a></p>
<p> The deployment is successful when you see one or more LogDNA pods. The number of LogDNA pods equals the number of worker nodes in your cluster. All pods must be in a Running state.</p>
</li>
<li><p>To check that the secret containing the access key has been created, you can run the following command:</p>
<pre class="language-"><code class="lang-sh"> kubectl get secrets
</code></pre>
</li>
</ol>
<h2 id="view-logs-in-the-logdna-dashboard">View logs in the LogDNA dashboard</h2>
<ol>
<li><p>After you configure a log source, launch the LogDNA UI by clicking <strong>View LogDNA</strong>.</p>
<p> <div class="alert alert-info hints-alert"><div class="hints-icon"><i class="fa fa-info-circle"></i></div><div class="hints-container"><p> This might take a few minutes before you start seeing logs. </p>
</div></div></p>
</li>
<li><p>Since namespace is a field that LogDNA collects, you can use the search function to filter your namespace. Use <code>namespace:name</code> to view only the logs of the applications deployed to the specified namespace.</p>
<blockquote>
<p>Note: With the Free service plan, you can tail your latest logs only.</p>
</blockquote>
</li>
<li><p>If your app is still running you can create a new todo with the Web UI or using curl</p>
<pre class="language-"><code> curl -d &apos;{&quot;text&quot;:&quot;newlog&quot;}&apos; -H &quot;Content-Type: application/json&quot; -X POST https://todo.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cluster-name</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>region</span><span class="token punctuation">&gt;</span></span>.containers.appdomain.cloud/api/todos
</code></pre></li>
<li><p>As you go through the next steps, keep an eye on the LogDNA console for new log statements coming from your apps deployed in this namespace.</p>
<p>      <a href="images/logdna-console.png" rel="grouped" title="LogDNA dashboard" target="_self" class="fancybox">
       <img src="images/logdna-console.png" alt="LogDNA dashboard">
     </a></p>
</li>
</ol>
<h2 id="resources">Resources</h2>
<p>For additional resources pay close attention to the following:</p>
<ul>
<li>More about IBM Log Analysis with LogDNA in the <a href="https://cloud.ibm.com/docs/services/Log-Analysis-with-LogDNA/index.html#getting-started" target="_blank">IBM Cloud documentation</a>.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="devops-continuous-delivery.md" class="navigation navigation-prev " aria-label="Previous page: Deploy with Continuous Delivery">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="monitor-cluster-metrics.html" class="navigation navigation-next " aria-label="Next page: Monitoring your cluster">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Cluster Logs","level":"5.1","depth":1,"next":{"title":"Monitoring your cluster","level":"5.2","depth":1,"path":"monitor-cluster-metrics.md","ref":"monitor-cluster-metrics.md","articles":[]},"previous":{"title":"Deploy with Continuous Delivery","level":"4.2","depth":1,"path":"devops-continuous-delivery.md","ref":"devops-continuous-delivery.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","collapsible-chapters","hints","copy-code-button","back-to-top-button","fancybox","web-header"],"root":"book","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"webheader":{"headerTitle":"IBM Cloud Kubernetes Service (IKS) Lab"},"prism":{"css":["prismjs/themes/prism-tomorrow.css"]},"fancybox":{"helpers":{"buttons":{}},"openEffect":"elastic","closeEffect":"elastic"},"web-header":{},"search":{},"collapsible-chapters":{},"hints":{"danger":"fa fa-exclamation-circle","info":"fa fa-info-circle","tip":"fa fa-mortar-board","working":"fa fa-wrench"},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"back-to-top-button":{},"copy-code-button":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"IBM Cloud Kubernetes Service Lab","gitbook":"3.2.3"},"file":{"path":"monitor-cluster-logs.md","mtime":"2018-11-11T11:11:11.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-11T11:11:11.000Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-collapsible-chapters/collapsible-chapters.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-copy-code-button/toggle.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.mousewheel.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox.pack.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/jquery.fancybox-buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fancybox/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-web-header/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

